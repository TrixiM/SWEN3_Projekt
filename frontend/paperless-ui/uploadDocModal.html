<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>DMS - Upload Document</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1173d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "text-light": "#101922",
                        "text-dark": "#f6f7f8",
                        "border-light": "#e3e8ee",
                        "border-dark": "#2a3a4a",
                        "muted-light": "#6b7f99",
                        "muted-dark": "#8a9eb5",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        "modal": "0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)",
                    }
                },
            },
        }
    </script>
    <style>
        .custom-file-input {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
        .custom-file-input + label {
            cursor: pointer;
        }
    </style>
    <script>
        const API_BASE = '/api';

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const fileInput = document.getElementById('file-upload');
            const fileLabel = document.querySelector('label[for="file-upload"]');
            
            // Update label when file is selected
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    fileLabel.querySelector('p.text-lg').textContent = fileName;
                }
            });

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('title').value.trim();
                const file = fileInput.files[0];
                const tagsInput = document.getElementById('tags').value.trim();
                
                if (!title) {
                    showMessage('Please enter a document title', 'danger');
                    return;
                }
                
                if (!file) {
                    showMessage('Please select a file', 'danger');
                    return;
                }
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('title', title);
                    
                    // Parse and append tags
                    if (tagsInput) {
                        const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
                        tags.forEach(tag => {
                            formData.append('tags', tag);
                        });
                    }
                    
                    showMessage('Uploading document...', 'info');
                    
                    const response = await fetch(`${API_BASE}/documents`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log('Document uploaded:', result);
                    
                    showMessage('Document uploaded successfully!', 'success');
                    
                    // Reset form
                    form.reset();
                    fileLabel.querySelector('p.text-lg').textContent = 'Drag and drop a file here';
                    
                    // Redirect to main page after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error uploading document:', error);
                    showMessage(`Error uploading document: ${error.message}`, 'danger');
                }
            });
        });

        function showMessage(message, type) {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                          type === 'danger' ? 'bg-red-500' : 
                          type === 'info' ? 'bg-blue-500' : 'bg-gray-500';
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            if (type !== 'info') {
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }, 3000);
            }
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
<div class="flex items-center justify-center min-h-screen">
    <div class="bg-background-light dark:bg-background-dark rounded-xl shadow-modal w-full max-w-lg">
        <div class="p-6 sm:p-8">
            <div class="mb-6 text-center">
                <h1 class="text-2xl sm:text-3xl font-bold text-text-light dark:text-text-dark">Upload Document</h1>
                <p class="text-muted-light dark:text-muted-dark mt-2">Add a new document to your Paperless library.</p>
            </div>
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-muted-light dark:text-muted-dark mb-2" for="title">Document Title</label>
                    <input class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary placeholder:text-muted-light dark:placeholder:text-muted-dark" id="title" placeholder="e.g., Q3 Financial Report" type="text"/>
                </div>
                <div>
                    <label class="block text-sm font-medium text-muted-light dark:text-muted-dark mb-2">File</label>
                    <div class="relative flex flex-col items-center justify-center w-full p-8 border-2 border-dashed border-border-light dark:border-border-dark rounded-lg text-center">
                        <input class="custom-file-input" id="file-upload" type="file"/>
                        <label class="w-full" for="file-upload">
                            <svg aria-hidden="true" class="mx-auto h-12 w-12 text-muted-light dark:text-muted-dark" fill="none" stroke="currentColor" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4V12a4 4 0 014-4h12l8 8z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                            </svg>
                            <p class="mt-4 text-lg font-semibold text-text-light dark:text-text-dark">Drag and drop a file here</p>
                            <p class="mt-1 text-sm text-muted-light dark:text-muted-dark">or</p>
                            <span class="mt-2 inline-block text-sm font-medium text-primary hover:text-primary/80">
                                    Click to select a file
                                </span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-muted-light dark:text-muted-dark mb-2" for="tags">Tags</label>
                    <input class="w-full bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary placeholder:text-muted-light dark:placeholder:text-muted-dark" id="tags" placeholder="Enter tags, separated by commas" type="text"/>
                </div>
                <div class="flex justify-end pt-2">
                    <button class="w-full sm:w-auto bg-primary text-white font-bold py-3 px-6 rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background-light dark:focus:ring-offset-background-dark focus:ring-primary transition-colors" type="submit">
                        Submit Document
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


</body></html>